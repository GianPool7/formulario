<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Reclamo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="libro.css">
    <link href="https://fonts.cdnfonts.com/css/clan-pro" rel="stylesheet">
</head>

<body>

    <div>
        <nav>
            <a href="index.html">Inicio</a>
            <a href="reclamos.html">Reclamos</a>
            <a href="libro.html">Libro de reclamaciones</a>
        </nav>
    </div>

    <div>
        <input type="number" disabled id="tipo" style="display: none;">

        <div class="cajas">
            <div class="caja" id="indecopi">
                <div class="titulo">
                    <h3>INDECOPI</h3>
                </div>
                <div class="contenedor">
                    <span>
                        Instituto Nacional de Defensa de la
                        Competencia y de la Protecci√≥n de la
                        Propiedad Intelectual, relacionado a quejas o
                        reclamos.
                    </span>
                    <div>
                        <p>Reclamo:</p>
                        <span>
                            Disconformidad respecto a los productos o servicios comercializados por la Empresa Operadora.
                        </span>
                    </div>
                    <div>
                        <p>Queja:</p>
                        <span>
                            Disconformidad, molestia o descontento respecto a la calidad de la atenci√≥n recibida por parte de la Empresa Operadora.
                        </span>
                    </div>
                </div>
            </div>

            <div class="caja" id="reclamos">
                <div class="titulo">
                    <h3>OSIPTEL</h3>
                </div>
                <div class="contenedor">
                    <span>
                        Organismo Supervisor de Inversi√≥n Privada
                        en Telecomunicaciones, relacionado
                        solamente al servicio de internet.
                    </span>
                    <li>Facturaci√≥n y Cobro</li>
                    <li>Calidad e idoneidad en la prestaci√≥n del Servicio</li>
                    <li>Incumplimiento de Condiciones Contractuales</li>
                    <li>Falta de Servicio</li>
                    <li>Instalaci√≥n, activaci√≥n o traslado del servicio</li>
                    <li>Falta de ejecuci√≥n de baja o suspensi√≥n del servicio.</li>
                    <li>Contrataci√≥n no solicitada</li>
                    <li>Migraci√≥n</li>
                    <li>Otras Materias Reclamables</li>
                </div>
            </div>
        </div>

        <div class="contenedor-preguntas" id="preguntas">

            <form action="" id="">

                <div class="caja-preguntas">

                    <div class="contendor-cajas" id="datosconsumidor">

                        <div class="preguntasolas">
                            <h2>Datos del consumidor</h2>
                            <hr>
                        </div>

                        <div class="preguntitas">
                            <div>
                                <label for="tipodocumento">Tipo de documento de identidad <span>*</span> </label>
                                <select name="tipodocumento" id="tipodocumento" required>
                                    <option value="" class="opcion-seleccionada">Selecciona un tipo de documento</option>
                                    <option value="DNI">Documento de Identidad (DNI)</option>
                                    <option value="RUC">Registro √önico de Contribuyentes (RUC)</option>
                                    <option value="Pasaporte">Pasaporte</option>
                                    <option value="CE">Carnet de Extranjer√≠a(CE)</option>
                                </select>
                                <span class="error-campo" id="error-tipodocumento" style="display: none;">Este campo es obligatorio</span>
                            </div>

                            <div>
                                <label for="numerodocumento">N¬∞ del documento de identidad <span>*</span> </label>
                                <input type="text" inputmode="numeric" pattern="[0-9]*" name="numerodocumento" id="numerodocumento" placeholder="Numero de identificacion *" required disabled>
                                <p class="badge" id="longitud" style="display: none;"> ! El numero del documento debe ser valido </p>
                                <span class="error-campo" id="error-numerodocumento" style="display: none;">Este campo es obligatorio</span>
                            </div>
                        </div>

                        <div class="preguntitas">
                            <div>
                                <label for="nombres">Nombres completos <span>*</span> </label>
                                <input type="text" name="nombres" id="nombres" placeholder="Nombres completos *" required>
                                <span class="error-campo" id="error-nombres" style="display:none;">Este campo es obligatorio</span>
                            </div>

                            <div>
                                <label for="apellidos">Apellidos completos <span>*</span> </label>
                                <input type="text" name="apellidos" id="apellidos" placeholder="Apellidos completos *" required>
                                <span class="error-campo" id="error-apellidos" style="display:none;">Este campo es obligatorio</span>
                            </div>
                        </div>

                        <div class="preguntitas">
                            <div>
                                <label for="menorEdad">Menor de edad <span>*</span> </label>
                                <select name="menorEdad" id="menorEdad" required>
                                    <option value="" class="opcion-seleccionada">Seleccionar Opci√≥n</option>
                                    <option value="Si">Si</option>
                                    <option value="No">No</option>
                                </select>
                                <span class="error-campo" id="error-menorEdad" style="display:none;">Este campo es obligatorio</span>
                            </div>

                            <div id="menor">

                                <label for="padre">Nombre del Pap√° o Mam√° <span>*</span> </label>
                                <input type="text" name="padre" id="padre">
                                
                            </div>


                        </div>

                        <div class="preguntitas">

                            <div>
                                <label for="departamento">Departamento <span>*</span></label>
                                <select name="departamento" id="departamento" required>
                                    <option value="Lima" class="opcion-seleccionada" selected>Lima</option>
                                </select>
                                <span class="error-campo" id="error-departamento" style="display:none;">Este campo es obligatorio</span>
                            </div>

                            <div>
                                <label for="provincias">Provincias<span>*</span> </label>
                                <select name="provincias" id="provincias" required>
                                    <option value="">Seleccionar Opci√≥n</option>
                                    <option value="128">Lima</option>
                                    <option value="134">Huarochiri</option>
                                    <option value="67">Callao</option>
                                </select>
                                <span class="error-campo" id="error-provincias" style="display:none;">Este campo es obligatorio</span>
                            </div>

                        </div>

                        <div class="preguntitas">

                            <div>
                                <label for="distritos">Distritos <span>*</span></label>
                                <select name="distritos" id="distritos">
                                </select>
                                <span class="error-campo" id="error-distritos" style="display:none;">Este campo es obligatorio</span>
                            </div>

                            <div>
                                <label for="correo">Direccion de correo electronico <span>*</span> </label>
                                <input type="email" name="correo" id="correo" placeholder="fiberpro@gmail.com" required>
                                <p class="badge" id="error-correo" style="display:none;">! El correo electr√≥nico debe ser v√°lido</p>
                                <!-- <span class="error-campo" id="error-correo" style="display:none;">Este campo es obligatorio</span> -->
                            </div>

                        </div>


                        <div class="preguntitas">

                            <div>
                                <label for="movil">Contacto de referencia (movil o fijo) <span>*</span> </label>
                                <input type="text" inputmode="numeric" pattern="[0-9]*" placeholder="999 999 999" maxlength="9" name="movil" id="movil" required>
                                <p class="badge" id="longitud-Movil"> solo tiene que contener 9 digitos </p>
                                <span class="error-campo" id="error-movil" style="display:none;">Este campo es obligatorio</span>
                            </div>
                        
                            <div>
                                <label for="direccion">Direcci√≥n <span>*</span> </label>
                                <input type="text" name="direccion" placeholder="Av." id="direccion" required>
                                <span class="error-campo" id="error-direccion" style="display:none;">Este campo es obligatorio</span>
                            </div>

                        </div>


                        
                        <div class="siOno">
                            <p>Autorizo ser notificado por el correo electr√≥nico registrado: </p>
                            <div class="radioinputs">
                                <div class="sino">
                                    <input type="radio" name="notificar" id="si" value="si">
                                    <label for="si">Si</label>
                                </div>
                                <div class="sino">
                                    <input type="radio" name="notificar" id="no" value="no">
                                    <label for="no">No</label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <p id="mensajeError" style="color: red; display: none;">Este campo es obligatorio.</p>
                        </div>

                        <div class="contenedor-notifiacion">
                            <div class="notificaciones" id="msj">
                                <p id="txtrespuesta"></p>
                                <span id="txtcorreo"></span>
                            </div>
                        </div>

                        <div class="next">
                            <p id="reclamos-queja">continuar</p>
                        </div>

                    </div>

                </div>
                
                <div id="contenedor-reclamos-queja">

                    <div class="back" id="contenedor-regresar">
                        <div>
                            <p id="regresar"> < Volver</p>
                        </div>
                    </div>

                    <div class="opciones" id="opciones-reclamo-queja">

                        <div class="caja" id="reclamo">
                            <div class="titulo">
                                <h2>Reclamo</h2>
                            </div>
                            <div class="contenedor">
                                <span>Disconformidad relacionada con los productos o servicios prestados comercializados por la Empresa Operadora.</span>
                            </div>
                        </div>

                        <div class="caja" id="queja">
                            <div class="titulo">
                                <h2>Queja</h2>
                            </div>
                            <div class="contenedor">
                                <span>Disconformidad, molestia o descontento en referencia a la calidad de la atenci√≥n brindada al consumidor, por parte de la Empresa Operadora.</span>
                            </div>
                        </div>

                    </div>


                    <div class="contendor-cajas">

                        <div class="preguntas-reclamos" id="contenedorpreguntasreclamos">

                            <div class="preguntasolas">
                                <div>
                                    <label for="materiareclamo">Materia de Reclamo <span>*</span></label>
                                    <select name="materiareclamo" id="materiareclamo">
                                        <option value="" disabled>Seleccionar reclamo</option>
                                        <option value="1">Problemas con mi router/Modem</option>
                                        <option value="2">Problemas con mi repetidor</option>
                                        <option value="3">otros</option>
                                    </select>
                                </div>

                            </div>


                        </div>

                        <div class="preguntas-queja" id="contenedorpreguntasquejas">

                            <div class="preguntasolas">
                                <div>
                                    <label for="materiaqueja">Materia de Queja <span>*</span></label>
                                    <select name="materiaqueja" id="materiaqueja">
                                        <option value="" disabled>Seleccionar Queja</option>
                                        <option value="4">Problema con la atenci√≥n por canal presencial.</option>
                                        <option value="5">Problema con la atenci√≥n por el canal WhatsApp.</option>
                                        <option value="6">Problema con la atenci√≥n por el canal telef√≥nico.</option>
                                        <option value="7">Problemas con la atenci√≥n al momento de la instalaci√≥n.</option>
                                        <option value="8">Problemas con la atenci√≥n durante la visita t√©cnica.</option>
                                        <option value="3">otros</option>
                                    </select>
                                </div>

                            </div>

                        </div>

                        <div class="" id="preguntas-reclamos-queja">

                            <div class="preguntasolas">

                                <div class="otroreclamos" style="display: none;" id="otrosreclamos">
                                    <label for="">Especificar</label>
                                    <input type="text" id="detalle-reclamo">
                                </div>

                            </div>

                            <div class="preguntitas" id="preguntasreclamos">
                                <div>
                                    <p>Identificaci√≥n del Producto o Servicio adquirido <span>*</span></p>
                                    <input type="text" id="producto" >
                                </div>
                                <div>
                                    <p>Monto del producto o servicio adquirido objeto del reclamo <span>*</span></p>
                                    <input type="number" id="precio">
                                </div>
                            </div>

                            <div class="preguntitas" id="cajaqueja">
                                <div>
                                    <p>Especifique su inconveniente <span>*</span></p>
                                    <input type="text" id="detalle">
                                </div>
                                <div>
                                    <p>Pedido concreto del consumidor: <span>*</span></p>
                                    <input type="text" id="pedido">
                                </div>
                            </div>

                            <div class="preguntasolas">
                                <div>
                                    <label for="">Agregar informaci√≥n adicional (Opcional)</label>
                                    <input type="file" name="" id="pruebasFile">
                                </div>
                            </div>

                        </div>


                        <div class="btn" id="boton-reclamos">
                            <button id="enviarReclamo">Enviar</button>
                        </div>

                    </div>

                </div>
                

            </form>

            <div id="descargarTicketContainer" class="contenedor-ticket">
                <div>
                    <h3>Gracias,</h3>
                    <p>Has llenado correctamente el formulario</p>
                    <p id="codigo"></p>
                    <button id="descargarTicket" class="descargar">Descargar Documento</button>
                    <a href="https://fiberpro.com.pe/" class="inicio">Inicio</a>
                </div>
            </div>

        </div>
    </div>
    <!-- Pegas la imagen como <img> oculta en el HTML -->
    <img id="logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..." style="display: none;">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        // para presionar el enter

        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                const tag = event.target.tagName.toLowerCase();
                const type = event.target.type ? event.target.type.toLowerCase() : "";

                // Bloquea ENTER excepto en <textarea>
                if (tag !== 'textarea' && type !== 'submit' && type !== 'button') {
                    event.preventDefault();
                }
            }
        });

        // para validar el correo
        const correo = document.getElementById('correo');
        const errorCorreo = document.getElementById('error-correo');

        // Regex para validar dominios espec√≠ficos
        const correoValidoRegex = /^[a-zA-Z0-9._%+-]+@(gmail\.com|hotmail\.com|outlook\.com|[\w.-]+\.edu.pe)$/i;

        correo.addEventListener('input', () => {
            const esValido = correoValidoRegex.test(correo.value);

            if (!esValido) {
                errorCorreo.style.display = 'inline';
            } else {    
                errorCorreo.style.display = 'none';
            }
        });


        // fin de validacion del correo
        // cantidad de numero en el DNI - lo cambia a numerico
        const tipodocumento = document.getElementById('tipodocumento');
        const cajaNroDocumento = document.getElementById('numerodocumento');
        const longitudMaxima=document.getElementById('longitud');

        let longitudEsperada = 0;

        // Actualizar estado seg√∫n tipo
        tipodocumento.addEventListener('change', () => {
            cajaNroDocumento.value = "";
            longitudMaxima.style.display = "none"; // Ocultar mensaje

            switch (tipodocumento.value) {
                case "DNI":
                    cajaNroDocumento.disabled = false;
                    longitudEsperada = 8;
                    cajaNroDocumento.setAttribute("maxlength", longitudEsperada);
                    break;
                case "RUC":
                    cajaNroDocumento.disabled = false;
                    longitudEsperada = 11;
                    cajaNroDocumento.setAttribute("maxlength", longitudEsperada);
                    break;
                case "CE":
                case "Pasaporte":
                    cajaNroDocumento.disabled = false;
                    longitudEsperada = 12;
                    cajaNroDocumento.setAttribute("maxlength", longitudEsperada);
                    break;
                case "":
                    cajaNroDocumento.disabled = true;
                    cajaNroDocumento.removeAttribute("maxlength");
                    longitudEsperada = 0;
                    break;
                default:
                    cajaNroDocumento.disabled = false;
                    cajaNroDocumento.removeAttribute("maxlength");
                    longitudEsperada = 0;
            }
        });

        // Permitir solo n√∫meros y validar longitud
        cajaNroDocumento.addEventListener('input', () => {
            // Quitar caracteres no num√©ricos
            cajaNroDocumento.value = cajaNroDocumento.value.replace(/\D/g, '');

            // Validar longitud si longitudEsperada > 0
            if (longitudEsperada > 0) {
                if (cajaNroDocumento.value.length !== longitudEsperada) {
                    longitudMaxima.style.display = "flex"; // Mostrar mensaje
                } else {
                    longitudMaxima.style.display = "none"; // Ocultar mensaje
                }
            } else {
                longitudMaxima.style.display = "none"; // Ocultar mensaje si no hay longitud esperada
            }
        });

        // movil

        const movil = document.getElementById('movil');
        const mensajeMovil = document.getElementById('longitud-Movil');

        const LONGITUD_MOVIL = 9;

        // Ocultamos el mensaje inicialmente
        mensajeMovil.style.display = "none";

        movil.addEventListener('input', () => {
            // Solo n√∫meros
            movil.value = movil.value.replace(/\D/g, '');

            // Validar longitud exacta
            if (movil.value.length !== LONGITUD_MOVIL) {
                mensajeMovil.style.display = "flex";  // Mostrar mensaje
            } else {
                mensajeMovil.style.display = "none";  // Ocultar mensaje
            }
        });

        //
        // el convertidor de archivo a binario
        async function getBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); // s√≥lo el base64, sin el prefijo data:
                reader.onerror = error => reject(error);
            });
        }
        //
        const tipo=document.getElementById('tipo');
        // const cuando escojemos
        const indecopi=document.getElementById("indecopi");
        const reclamos = document.getElementById("reclamos");
        const queja=document.getElementById("queja");
        const reclamo=document.getElementById("reclamo");
        const edad=document.getElementById("menorEdad");
        const txt=document.getElementById("txtrespuesta")
        const direccioncorreo=document.getElementById("txtcorreo")
        const direccion=document.getElementById("direccion")
        const materiareclamo=document.getElementById("materiareclamo")
        const materiaqueja=document.getElementById("materiaqueja")
        // const de las preguntas que estan invisible
        const preguntas=document.getElementById("preguntas");
        const preguntasreclamos=document.getElementById("contenedorpreguntasreclamos")
        const preguntasquejas=document.getElementById("contenedorpreguntasquejas")
        const preguntasmenor=document.getElementById("menor")
        const message=document.getElementById("msj")
        const otrosreclamos=document.getElementById("otrosreclamos")
        // para el radio buttom si
        const boton=document.getElementById("boton-reclamos")
        boton.style.display="none"
        // el contenedor de los datos de consumidor
        const datosconsumidor=document.getElementById("datosconsumidor")
        // las opciones
        const reclamoQueja=document.getElementById("opciones-reclamo-queja")
        // para voler
        const btnRegresar=document.getElementById("contenedor-regresar")
        // cajas parecidad
        const cajareclamo=document.getElementById("preguntasreclamos")
        // caja completa de las pregutnas de reclamos
        const cajapreguntasreclamosquejas=document.getElementById("preguntas-reclamos-queja")
        cajapreguntasreclamosquejas.style.display="none"
        // 
        const contenedorreclamoyqueja=document.getElementById("contenedor-reclamos-queja")


        // para que aparezcan reclamo o queja
        document.getElementById("reclamos-queja").addEventListener('click', function () {
            const campos = [
                'tipodocumento',
                'numerodocumento',
                'nombres',
                'apellidos',
                'menorEdad',
                'departamento',
                'provincias',
                'distritos',
                'correo',
                'movil',
                'direccion'
            ];

            let formularioValido = true;

            campos.forEach(id => {
                const campo = document.getElementById(id);
                const error = document.getElementById('error-' + id);

                if (!campo.value.trim()) {
                    formularioValido = false;
                    campo.classList.add('campo-invalido');
                    if (error) error.style.display = 'block';
                } else {
                    campo.classList.remove('campo-invalido');
                    if (error) error.style.display = 'none';
                }

                // Opci√≥n: actualizar error al escribir luego de hacer clic
                campo.addEventListener('input', () => {
                    if (campo.value.trim()) {
                        campo.classList.remove('campo-invalido');
                        if (error) error.style.display = 'none';
                    }
                });
            });

            // Validar el campo radio "notificar"
            const notificar = document.querySelector('input[name="notificar"]:checked');
            if (!notificar) {
                document.getElementById('mensajeError').style.display = 'block';
                formularioValido = false;
            } else {
                document.getElementById('mensajeError').style.display = 'none';
            }

            if (formularioValido) {
                // Mostrar siguiente secci√≥n
                reclamoQueja.style.display = 'flex';
                contenedorreclamoyqueja.style.display = "block";
                datosconsumidor.style.display = "none";
                btnRegresar.style.display = "flex";
            }
        });

        //
        const radios = document.querySelectorAll('input[name="notificar"]');
        radios.forEach(radio => {
        radio.addEventListener("change", () => {
                if (radio.value === "si" && radio.checked) {
                    message.style.display = "block";
                    txt.textContent=`La respuesta ser√° notificada al siguiente correo electr√≥nico:`
                    direccioncorreo.textContent=`${correo.value}`
                } else if (radio.value === "no" && radio.checked) {
                    message.style.display = "block";
                    txt.textContent=`La respuesta ser√° notificada a la siguiente direcci√≥n:`
                    direccioncorreo.textContent=`${direccion.value}`
                }
            });
        });

        // para otros  en materia reclamable o queja

        if (materiareclamo) {
            materiareclamo.addEventListener("click",()=>{
                if (materiareclamo.value==="3") {
                    otrosreclamos.style.display="block";
                }else{
                    otrosreclamos.style.display="none"
                }
            })
            
        }

        if (materiaqueja) {
            materiaqueja.addEventListener("click",()=>{
                if (materiaqueja.value==="3") {
                    otrosreclamos.style.display="block";
                }else{
                    otrosreclamos.style.display="none"
                }
            })
            
        }


        if(edad){
            edad.addEventListener("click",()=>{
                if (edad.value === "Si") {
                    preguntasmenor.style.display = "block"; // muestra la caja
                } else {
                    preguntasmenor.style.display = "none"; // oculta la caja
                }
            })
        }

        if (reclamo) {
            reclamo.addEventListener("click",()=>{
                preguntasreclamos.style.display="block";
                preguntasquejas.style.display="none";
                boton.style.display="flex"
                cajareclamo.style.display="flex"
                cajapreguntasreclamosquejas.style.display="block"
                // limpiando cajas
                materiaqueja.value=""
                const productos=document.getElementById('producto').value=""
                const precio=document.getElementById('precio').value=""
                const detalle=document.getElementById('detalle').value=""
                const pedido=document.getElementById('pedido').value=""
                // agregando id al tipo
                tipo.value=1
            })
        }

        if (queja) {
            queja.addEventListener("click",()=>{
                preguntasquejas.style.display="block";
                preguntasreclamos.style.display="none";
                boton.style.display="flex"
                cajareclamo.style.display="none"
                cajapreguntasreclamosquejas.style.display="block"
                // limpiando cajas
                materiareclamo.value=""
                const productos=document.getElementById('producto').value=""
                const precio=document.getElementById('precio').value=""
                const detalle=document.getElementById('detalle').value=""
                const pedido=document.getElementById('pedido').value=""
                // agregando id al tipo
                tipo.value=2
            })
        }

        if (indecopi) {
            indecopi.addEventListener("click",()=>{
                preguntas.style.display = "block";
            })
        }

        if (reclamos) {
            reclamos.addEventListener("click", () => {
            window.open("https://fiberpro.com.pe/reclamos/", "_blank");
            });
        }

        const provinciaSelect = document.getElementById('provincias');
        const distritoSelect = document.getElementById('distritos');

        provinciaSelect.addEventListener('change', function () {
        const provinciaId = this.value;

        // üî¥ Limpiar el select de distritos antes de cargar nuevos
        distritoSelect.innerHTML = '';

        if (!provinciaId) return;

        fetch(`https://app-externos.fiberpro.com.pe/api/get_district/${provinciaId}`)
                .then(response => {
                    if (!response.ok) throw new Error('Error en la API');
                    return response.json();
                })
                .then(data => {
                    data.forEach(distrito => {
                        const option = document.createElement('option');
                        option.value = distrito.value;
                        option.textContent = distrito.label;
                        distritoSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    distritoSelect.innerHTML = '<option value="">Error al cargar</option>';
                    console.error('Error:', error);
                });
        });

        // para regresar

        const regresar=document.getElementById("regresar").addEventListener("click",()=>{
            datosconsumidor.style.display="block"
            // reclamoQueja.style.display = 'none';
            btnRegresar.style.display="none"
            cajapreguntasreclamosquejas.style.display="none"
            contenedorreclamoyqueja.style.display="none"
            // limpiando cajas
            materiareclamo.value=""
            materiaqueja.value=""
            const productos=document.getElementById('producto').value=""
            const precio=document.getElementById('precio').value=""
            const detalle=document.getElementById('detalle').value=""
            const pedido=document.getElementById('pedido').value=""
            //
            preguntasreclamos.style.display="none";
            preguntasquejas.style.display="none";
            //
            boton.style.display="none"
        })


        // para enviar ala api
        document.getElementById('enviarReclamo').addEventListener('click',async function (event) {

            if (event.key === 'Enter') {
                event.preventDefault();
            }

            event.preventDefault();
            // file
            const fileInput = document.getElementById('pruebasFile');
                let pruebasBase64 = null;
                if (fileInput.files.length > 0) {
                    pruebasBase64 = await getBase64(fileInput.files[0]);
                }
            //
            const boton = document.getElementById('enviarReclamo');
            const textoOriginal = boton.textContent;
            boton.textContent = 'Enviando...';
            boton.disabled = true; // evitar doble clic
            btnRegresar.style.display="none"
            //
            // tipo de libro de reclamaciones
            const tipo=document.getElementById('tipo').value;
            //
            const tipodocumento=document.getElementById('tipodocumento').value.trim();
            const numerodocumento=document.getElementById('numerodocumento').value.trim();
            const nombrescompletos=document.getElementById('nombres').value.trim();
            const apellidoscompletos=document.getElementById('apellidos').value.trim();
            const menorEdad=document.getElementById('menorEdad').value.trim()
            const departamento=document.getElementById('departamento').value.trim()
            const provincias=document.getElementById('provincias').value.trim()
            const distrito=document.getElementById('distritos').value.trim()
            const correoelectronico=document.getElementById('correo').value.trim()
            const movil=document.getElementById('movil').value.trim()
            const direccioncasa=document.getElementById('direccion').value.trim()
            const nombrePadre=document.getElementById('padre').value.trim()

            const autorizacionRaw = document.querySelector('input[name="notificar"]:checked')?.value || "";
            const autorizacion = autorizacionRaw === "si" ? "si" : ""; // vacio si es no



            const materiareclamable=document.getElementById('materiareclamo').value.trim() || document.getElementById('materiaqueja').value.trim();
            const otrosreclamable=document.getElementById('detalle-reclamo').value.trim();

            const productos=document.getElementById('producto').value.trim()
            const precio=document.getElementById('precio').value.trim()
            const detalle=document.getElementById('detalle').value.trim()
            const pedido=document.getElementById('pedido').value.trim()

        
            //console.log("Autorizaci√≥n seleccionada:", autorizacion); // üëà Prueba esto

            //const materiadequeja=document.getElementById('materiaqueja').value.trim()
            // const otrasquejas=document.getElementById('otrasquejas')?.value.trim() || "";

            const libroreclamaciones={
                //
                tipo,
                //
                tipodocumento,
                numerodocumento,
                nombrescompletos,
                apellidoscompletos,
                menorEdad,
                departamento,
                provincias,
                distrito,
                correoelectronico,
                movil,
                direccioncasa,
                autorizacion,
                nombrePadre,
                materiareclamable,
                otrosreclamable,
                productos,
                precio,
                detalle,
                pedido,
            }

            // Agregar el archivo si existe
            if (pruebasBase64) {
                libroreclamaciones.pruebas = pruebasBase64;
            }

            const url = "https://libro-reclamaciones-fiberpro-e2b1f36f0380.herokuapp.com/api/libroreclamaciones";

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(libroreclamaciones)
                });

                const result = await response.json();

                if (result.ticket_id) {
                    // ‚úÖ √âxito
                    boton.style.display = 'none';
                    document.getElementById('descargarTicketContainer').style.display = 'flex';
                    document.getElementById('codigo').innerText = `Tu c√≥digo de reclamo es: ${result.ticket_id}`;
                    contenedorreclamoyqueja.style.display="none"
                    window.ticketInfo = {
                        ...libroreclamaciones,
                        ticket_id: result.ticket_id
                    };
                } else {
                    document.getElementById('codigo').innerText = 'Error al registrar el reclamo.';
                    console.error('Error:', result);
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Error de red o del servidor');
            } finally {
                // Restaurar bot√≥n si ocurri√≥ error (no se restaura si fue exitoso, porque lo ocultas)
                if (boton.style.display !== 'none') {
                    boton.textContent = textoOriginal;
                    boton.disabled = false;
                }
            }
        })

        function cargarImagenComoBase64(url) {
            return fetch(url)
                .then(res => res.blob())
                .then(blob => new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                }));
        }


        // para gener pdf
        document.getElementById('descargarTicket').addEventListener('click', async function () {
            const ticket = window.ticketInfo;
            if (!ticket) {
                alert('No hay informaci√≥n del ticket para generar PDF.');
                return;
            }

            // para convertir la materia reclamable


            let reclamoelegido=""
            let quejaelegido=""

            switch (parseInt(ticket.materiareclamable)) {
                case 1:
                    reclamoelegido="Problemas con mi router/Modem"
                    break;
                
                case 2:
                    reclamoelegido="Problemas con mi repetidor"
                    break;

                case 3:
                    reclamoelegido="Otros"
                    break;
                
                case 4:
                    quejaelegido="Problema con la atenci√≥n por canal presencial."
                    break;

                case 5:
                    reclamoelegido="Problema con la atenci√≥n por el canal WhatsApp."
                    break;
                
                case 6:
                    quejaelegido="Problema con la atenci√≥n por el canal telef√≥nico."
                    break;
            
                case 7:
                    quejaelegido="Problemas con la atenci√≥n al momento de la instalaci√≥n."
                    break;
                
                case 8:
                    quejaelegido="Problemas con la atenci√≥n durante la visita t√©cnica."
                    break;

                default:
                        reclamoelegido = "";
                        quejaelegido = "";
                    break;
            }

            var provincia=""
            switch (parseInt(ticket.provincias)) {
                case 128:
                    provincia="Lima"
                    break;
            
                default:
                    break;
            }

            //

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const logoURL = "data:image/png;base64,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";

            // üéØ Header azul personalizado (#002ccc)
            doc.setFillColor(0, 44, 204); // R, G, B
            doc.rect(0, 0, 210, 30, 'F');  // Rect√°ngulo: x, y, width, height, tipo (F = fill)

            // üì∑ Logo (x, y, width, height)
            doc.addImage(logoURL, 'PNG', 4, 5, 50, 20);

            // T√≠tulo del Header
            doc.setFontSize(18);
            doc.setTextColor(255, 255, 255); // Texto blanco
            doc.setFont("Helvetica","bold");
            doc.text("LIBRO DE RECLAMACIONES", 105, 18, null, null, "center");

            // ================== ENCABEZADO ===================
            doc.setTextColor(0,0,0); // Texto negro
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(12);

            // Columna izquierda: Empresa
            doc.text("PYD Telecom S.R.L ‚Äì RUC: 20556147761", 10, 37);
            doc.text("Av. L Mza. L Lote. 48, Carabayllo, Lima", 10, 44);

            // Columna derecha: Fecha y C√≥digo
            const fechaActual = new Date().toLocaleDateString();
            doc.text(`Fecha: ${fechaActual}`, 150, 37);
            doc.text(`C√≥digo de Reclamaci√≥n: ${ticket.ticket_id}`, 110, 44);

            // ================== SECCI√ìN 1 ===================
            let y = 60;
            doc.setFontSize(14);
            doc.setFont("Helvetica", "bold");
            doc.text("1. IDENTIFICACI√ìN DEL CONSUMIDOR", 10, y);

            y += 10;
            doc.setFontSize(12);

            // Campos de identificaci√≥n
            const datosConsumidor = [
            ["Nombres y apellidos completos:", `${ticket.nombrescompletos} ${ticket.apellidoscompletos}`],
            ["Domicilio:", ticket.direccioncasa],
            ["Departamento / Provincia / Distrito:", `${ticket.departamento} / ${provincia} / ${ticket.distrito}`],
            ["Tipo y N¬∞ de Documento de Identidad:", `${ticket.tipodocumento} - ${ticket.numerodocumento}`],
            ["Correo Electr√≥nico:", ticket.correoelectronico],
            ["Celular:", ticket.movil],
            ["¬øEres menor de edad?", ticket.menorEdad]
            ];

            datosConsumidor.forEach(([label, value]) => {
            doc.setFont("Helvetica", "bold");
            doc.text(label, 10, y);
            y += 6;
            doc.setFont("Helvetica", "normal");
            doc.text(doc.splitTextToSize(value, 190), 10, y);
            y += 10;
            });

            // ================== SECCI√ìN 2 ===================
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(14);
            doc.text("2. IDENTIFICACI√ìN DEL BIEN ADQUIRIDO", 10, y);
            y += 10;

            doc.setFontSize(12);
            const datosProducto = [
            ["Tipo de bien:", reclamoelegido || quejaelegido ],
            ["Monto del producto o servicio:", ticket.precio],
            ["Descripci√≥n:", ticket.detalle]
            ];

            datosProducto.forEach(([label, value]) => {
            doc.setFont("Helvetica", "bold");
            doc.text(label, 10, y);
            y += 6;
            doc.setFont("Helvetica", "normal");
            doc.text(doc.splitTextToSize(value, 190), 10, y);
            y += 10;
            });

            // Salto a segunda hoja
            doc.addPage();

            // ================== SECCI√ìN 3 ===================
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(14);
            doc.text("3. TIPO Y DETALLE DE LA RECLAMACI√ìN", 10, 30);


            // Datos para la tabla
            // const headers = [["Columna 1", "Columna 2", "Columna 3"]];
            const data3 = [
            [      { content: "Tipo de Reclamaci√≥n", rowSpan: 2, styles: { valign: 'middle', halign: 'center' } },
                "Reclamo",
                "Queja"
            ],
            [`${reclamoelegido}` , `${quejaelegido}`,{styles: { valign: 'middle', halign: 'center' } }],
            [
                { content: "Detalle de la Reclamaci√≥n", colSpan: 3, styles: { halign: 'center' } }
            ],
            [{
                content:`${ticket.detalle}`,colSpan:3,styles:{halign:'center'}
            }],
            [{
                content:"Pedido concreto del consumidor", colSpan:3,styles:{halign:'center'}
            }],
            [{
                content:`${ticket.pedido}`,colSpan:3,styles:{halign:'center'}
            }
            ]
            ];

            // Crear la tabla
            doc.autoTable({
            // head: headers,
            body: data3,
            startY: 40, // posici√≥n vertical donde empieza la tabla
            theme: 'grid', // << aqu√≠ va el theme
            columnStyles: {
                    0: { cellWidth: 'wrap' }, // Tipo de Reclamaci√≥n
                    1: { cellWidth: 'wrap' }, // Reclamo
                    2: { cellWidth: 'wrap' }  // Queja
                }
            });


            // ================== SECCI√ìN 4 ===================
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(14);
            doc.text("4. OBSERVACIONES Y ACCIONES ADOPTADAS", 10, 100);

            // Datos para la tabla
            // const headers = [["Columna 1", "Columna 2", "Columna 3"]];
            const data4 = [
            [  
                `Reclamo:\n\n${reclamoelegido}`,
                `Queja:\n\n${quejaelegido}`
            ],
            [  
                ``,
                ``
            ],
            [  
                "FIRMA DEL CONSUMIDOR",
                `FIRMA DEL PROVEEDOR`
            ],
            ];

            // Crear la tabla
            doc.autoTable({
            // head: headers,
            body: data4,
            startY: 110, // posici√≥n vertical donde empieza la tabla
            theme: 'grid' // << aqu√≠ va el theme
            });


            // ================== SECCI√ìN 5 ===================
            doc.setFontSize(14);
            doc.setFont("Helvetica", "normal");
            const texto1 = "*El proveedor deber√° dar respuesta al reclamo en un plazo no mayor a quince (15) d√≠as h√°biles improrrogable.";
            const texto2 = "*Esta cuenta de correo se utiliza exclusivamente para el env√≠o de constancias de recepci√≥n de reclamos. No est√° habilitada para recibir mensajes. Por favor, s√≠rvase de no enviar correos a esta direcci√≥n electr√≥nica.";

            const maxWidth = 190; // Ancho m√°ximo de texto en mm

            const lines1 = doc.splitTextToSize(texto1, maxWidth);
            const lines2 = doc.splitTextToSize(texto2, maxWidth);

            doc.text(lines1, 10, 170); 
            // Para el segundo texto, la Y debe sumar la cantidad de l√≠neas * alto l√≠nea (por ejemplo 7 u 8)
            doc.text(lines2, 10, 170 + lines1.length * 7 + 5);
            
            doc.save(`${ticket.ticket_id}.pdf`);

        });



    </script>

</body>

</html>